<MudDialog>
    <TitleContent>Create Entry</TitleContent>
    <DialogContent>
        <MudTextField Label="Title" @bind-Value="Title" Required="true" />
        <MudTextField Label="Username" @bind-Value="Username" />
        <MudTextField Label="Password" @bind-Value="Password" InputType="InputType.Password" Required="true" />
        <MudTextField Label="Url" @bind-Value="Url" />
        <MudTextField Label="Commentary" @bind-Value="Commentary"/>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Save" Color="Color.Primary" Variant="Variant.Filled">Save</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] IMudDialogInstance MudDialog { get; set; } = default!;
    [Parameter] public EventCallback<VaultEntryService.VaultEntry> OnSave { get; set; }

    private string Title { get; set; } = string.Empty;
    private string Username { get; set; } = string.Empty;
    private string Password { get; set; } = string.Empty;
    private string Url { get; set; } = string.Empty;
    private string Commentary { get; set; } = string.Empty;

    private string DerivedKey { get; set; } = string.Empty;
    private string Salt { get; set; } = string.Empty;

    private async Task Save()
    {
        if (!string.IsNullOrWhiteSpace(Title) && !string.IsNullOrWhiteSpace(Password))
        {
            var newVault = new VaultEntryService.VaultEntry
            {
                Id = Guid.NewGuid(),
                CipherTitle = Title,
                CipherUsername = Username,
                CipherPassword = Password,
                CipherUrl = Url,
            };

            await OnSave.InvokeAsync(newVault);
            MudDialog.Close();
        }
    }

    private void Cancel()
    {
        MudDialog.Cancel();
    }
}